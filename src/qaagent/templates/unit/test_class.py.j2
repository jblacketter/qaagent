"""
Auto-generated unit tests for {{ resource_name }} API
Generated by QA Agent
"""

import pytest
from unittest.mock import Mock, patch, MagicMock
import httpx


class Test{{ resource_name|title }}API:
    """Unit tests for /{{ resource_name }} endpoints"""

    {% for case in test_cases %}
    {% if case.type == "happy_path" %}
    def {{ case.name }}(self, api_client):
        """{{ case.description }}"""
        {% if case.route.method in ["POST", "PUT", "PATCH"] %}
        # Arrange
        test_data = {{ case.test_data|tojson }}

        # Act
        response = api_client.{{ case.route.method.lower() }}("{{ case.route.path }}", json=test_data)

        # Assert
        assert response.status_code == {{ case.expected_status }}
        {% if case.route.method == "POST" %}
        data = response.json()
        assert "id" in data or data is not None
        {% endif %}
        {% else %}
        # Act
        response = api_client.{{ case.route.method.lower() }}("{{ case.route.path }}")

        # Assert
        assert response.status_code == {{ case.expected_status }}
        {% if case.route.method == "GET" %}
        # Verify response structure
        data = response.json()
        assert data is not None
        {% endif %}
        {% endif %}

    {% elif case.type == "invalid_data" %}
    def {{ case.name }}(self, api_client):
        """{{ case.description }}"""
        # Arrange
        invalid_data = {{ case.test_data|tojson }}  # Empty or invalid data

        # Act
        response = api_client.{{ case.route.method.lower() }}("{{ case.route.path }}", json=invalid_data)

        # Assert
        assert response.status_code in [400, 422]  # Bad Request or Unprocessable Entity

    {% elif case.type == "parametrized" %}
    @pytest.mark.parametrize("invalid_param", {{ case.parameters }})
    def {{ case.name }}(self, api_client, invalid_param):
        """{{ case.description }}"""
        # Arrange
        path = "{{ case.route.path }}".replace("{", "").replace("}", "")  # Simplified for testing
        {% if case.route.method in ["POST", "PUT", "PATCH"] %}
        test_data = {"id": invalid_param}
        {% endif %}

        # Act
        {% if case.route.method in ["POST", "PUT", "PATCH"] %}
        response = api_client.{{ case.route.method.lower() }}(f"{{ case.route.path.split('{')[0] }}{invalid_param}", json=test_data)
        {% else %}
        response = api_client.{{ case.route.method.lower() }}(f"{{ case.route.path.split('{')[0] }}{invalid_param}")
        {% endif %}

        # Assert
        assert response.status_code in [400, 404, 422]  # Client error

    {% endif %}
    {% endfor %}
